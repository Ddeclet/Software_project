<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calendario Académico - AcademicConnect</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="https://kit.fontawesome.com/a2d9d6bc50.js" crossorigin="anonymous"></script>
</head>
<body>

  <!-- Barra superior -->
  <header>
    <div class="logo">
      <img src="{{ url_for('static', filename='images/logoAC.png') }}" alt="Logo">
      <h1>AcademicConnect</h1>
    </div>
    <nav>
       {% if session.role == "user" %}
        <div class="profile-icon">
          <img src="{{ url_for('static', filename='images/perfil.png') }}" alt="Perfil" class="profile-img">
        </div>
        <a href="{{ url_for('index') }}">Inicio</a>
        <a href="{{ url_for('calendario') }}">Calendario</a>
        <a href="{{ url_for('horas') }}">Horas de oficina</a>
        <a href="{{ url_for('logout') }}">
          <img src="{{ url_for('static', filename='images/logout.png') }}" alt="Logout" class="logout-icon">
        </a>
        {%elif session.role == "superadmin"%}
        <div class="profile-icon">
          <img src="{{ url_for('static', filename='images/perfil.png') }}" alt="Perfil" class="profile-img">
        </div>
        <a href="{{ url_for('superadmin_home') }}">Inicio</a>
        <a href="{{ url_for('calendario') }}">Calendario</a>
        <a href="{{ url_for('horas') }}">Departamentos</a>
        <a href="{{ url_for('logout') }}">
          <img src="{{ url_for('static', filename='images/logout.png') }}" alt="Logout" class="logout-icon">
        </a>
        {% else %}
        <div class="profile-icon">
          <img src="{{ url_for('static', filename='images/perfil.png') }}" alt="Perfil" class="profile-img">
        </div>
        <a href="{{ url_for('profesores_home') }}" class="active">Inicio</a>
        <a href="{{ url_for('calendario') }}">Calendario</a>
        <a href="{{ url_for('horas') }}">Horas de oficina</a>
        <a href="{{ url_for('logout') }}">
          <img src="{{ url_for('static', filename='images/logout.png') }}" alt="Logout" class="logout-icon">
        </a>
      {% endif %}
    </nav>
  </header>

  <!-- Contenido principal -->
  <main>
    <div class="calendar-header">
      <div class="info-icon" id="infoBtn" role="button" aria-label="Ayuda">
	      <img src="{{ url_for('static', filename='images/i.png') }}" alt="Información">
      </div>
      <div>
        <h2>Calendario Académico</h2>
        <h3>Primer Semestre 2025–2026</h3>
      </div>
      {% if session.role == "superadmin" %}
        <button class="sync-btn" id="addCalBtn">Añadir calendario</button>
      {% else %}
        <button class="sync-btn">Sincronizar calendario</button>
      {% endif %}

    </div>

    <section class="calendar-container">
      <h4>OCTUBRE 2025</h4>
      <div class="calendar-grid">
        <!-- Filas del calendario -->
        <div class="day empty"></div><div class="day empty"></div><div class="day">1</div><div class="day">2</div><div class="day">3</div><div class="day">4</div><div class="day">5</div>
        <div class="day event yellow">6</div><div class="day">7</div><div class="day">8</div><div class="day">9</div><div class="day">10</div><div class="day">11</div><div class="day">12</div>
        <div class="day event yellow"><b>13</b><br>Feriado: Día de la Raza</div>
        <div class="day">14</div><div class="day">15</div><div class="day">16</div><div class="day">17</div><div class="day">18</div><div class="day">19</div>
        <div class="day">20</div><div class="day">21</div><div class="day">22</div><div class="day event yellow"><b>23</b><br>Evaluación Parcial</div>
        <div class="day">24</div>
        <div class="day event green"><b>26</b><br>Reunión general de facultad</div>
        <div class="day">27</div><div class="day event yellow"><b>28</b><br>Receso académico</div><div class="day">29</div><div class="day">30</div><div class="day">31</div>
      </div>
    </section>

    {% if session.role == "superadmin" %}
    <!-- Modal Añadir calendario -->
    <div id="addCalModal" class="ac-modal ac-hidden" aria-hidden="true">
      <div class="ac-modal__backdrop" role="presentation"></div>

      <div class="ac-modal__panel" role="dialog" aria-modal="true" aria-labelledby="addCalTitle">
        <div class="ac-modal__header">
          <h3 id="addCalTitle">Añadir calendario</h3>
        </div>

        <form id="uploadForm" enctype="multipart/form-data" novalidate>
          <div id="dropArea" class="ac-dropzone" tabindex="0">
            <!-- Icono de la nube -->
            <svg width="44" height="44" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M7 18h9a4 4 0 0 0 .7-7.95A6 6 0 0 0 6 9a4 4 0 0 0 1 9Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 7v6m0 0-2-2m2 2 2-2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>

            <p class="ac-dropzone__title"><strong>Selecciona el archivo y arrástralo aquí</strong></p>
            <p class="ac-muted">archivo <code>.docx</code> no más de 10&nbsp;MB</p>

            <input id="fileInput" type="file" name="file" accept=".docx" hidden>
            <button type="button" class="ac-btn" id="selectFile">SELECT FILE</button>

            <p id="fileName" class="ac-muted" style="margin-top:8px;"></p>
          </div>

          <div class="ac-modal__actions">
            <button type="button" class="ac-btn ac-btn--ghost" id="cancelAdd">Cancelar</button>
            <button type="submit" class="ac-btn ac-btn--primary" id="uploadBtn" disabled>Subir</button>
          </div>
        </form>
      </div>
    </div>
    {% endif %}
    
    {% if session.role == "superadmin" %}
    <script>
    (function () {
      const addBtn   = document.getElementById('addCalBtn');
      const modal    = document.getElementById('addCalModal');
      const backdrop = modal?.querySelector('.ac-modal__backdrop');
      const cancel   = document.getElementById('cancelAdd');

      const drop     = document.getElementById('dropArea');
      const input    = document.getElementById('fileInput');
      const pickBtn  = document.getElementById('selectFile');
      const fileName = document.getElementById('fileName');
      const upload   = document.getElementById('uploadBtn');
      const form     = document.getElementById('uploadForm');

      const MAX_MB = 10;

      function openModal() {
        modal.classList.remove('ac-hidden');
        modal.setAttribute('aria-hidden','false');
      }
      function closeModal() {
        modal.classList.add('ac-hidden');
        modal.setAttribute('aria-hidden','true');
        // Reiniciar
        input.value = '';
        fileName.textContent = '';
        upload.disabled = true;
      }

      function validateFile(file){
        if (!file) return false;
        const okExt = /\.docx$/i.test(file.name);
        const okSize = file.size <= MAX_MB*1024*1024;
        if (!okExt) { alert('Solo se acepta archivo .docx'); return false; }
        if (!okSize){ alert('El archivo supera 10 MB'); return false; }
        return true;
      }

      function setFile(file){
        if (!validateFile(file)) return;
        fileName.textContent = `Archivo seleccionado: ${file.name}`;
        upload.disabled = false;
      }

      // Abrir / cerrar
      addBtn?.addEventListener('click', openModal);
      cancel?.addEventListener('click', closeModal);
      backdrop?.addEventListener('click', closeModal);
      window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });

      // Elegir mediante el botón
      pickBtn?.addEventListener('click', ()=> input.click());
      input?.addEventListener('change', (e)=> setFile(e.target.files?.[0]));

      // Drag and Drop
      ['dragenter','dragover'].forEach(evt=>{
        drop?.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); drop.classList.add('ac-dropzone--over'); });
      });
      ['dragleave','drop'].forEach(evt=>{
        drop?.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); drop.classList.remove('ac-dropzone--over'); });
      });
      drop?.addEventListener('drop', (e)=>{
        const file = e.dataTransfer?.files?.[0];
        if (file) setFile(file);
      });

      // Submit
      form?.addEventListener('submit', async (e)=>{
        e.preventDefault();
        if (!input.files?.[0]) return;

        closeModal();
      });
    })();
    </script>
    {% endif %}

    <!-- Icono de información -->
    <div id="infoModal" class="ac-modal ac-hidden" aria-hidden="true">
      <div class="ac-modal__backdrop" role="presentation"></div>

      <div class="ac-modal__panel" role="dialog" aria-modal="true" aria-labelledby="infoTitle">
        <div class="ac-modal__header">
          <h3 id="infoTitle">Información</h3>
        </div>

        {% if session.role == "superadmin" %}
          <!-- Contenido para superadmin -->
          <div class="tip-box">
            <ol>
              <li>El archivo del calendario académico debe ser <code>.docx</code>.</li>
              <li>Seleccione y arrastre el archivo al lugar correspondiente.</li>
              <li>Seleccione el botón de <b>Subir</b> para actualizar el calendario.</li>
            </ol>
          </div>
        {% else %}
          <!-- Contenido para usuarios/profesores -->
          <div class="tip-box">
            <ol>
              <li>Seleccione el botón de <b>“Sincronizar calendario”</b>.</li>
              <li>Abra el archivo <code>.ICS</code> en su dispositivo y seleccione la aplicación de calendario.</li>
              <li>Seleccione <b>“Agregar Todos”</b> para agregar todos los eventos.</li>
            </ol>
          </div>
        {% endif %}

        <div class="ac-modal__actions">
          <button type="button" class="ac-btn ac-btn--primary" id="closeInfoBtn">Entendido</button>
        </div>
      </div>
    </div>

    <script>
      (function () {
      // --- Icono de información
      const infoBtn     = document.getElementById('infoBtn');
      const infoModal   = document.getElementById('infoModal');
      const infoBackdrop= infoModal?.querySelector('.ac-modal__backdrop');
      const closeInfo   = document.getElementById('closeInfoBtn');

      function openInfo() {
        infoModal.classList.remove('ac-hidden');
        infoModal.setAttribute('aria-hidden','false');
      }
      function closeInfoModal() {
        infoModal.classList.add('ac-hidden');
        infoModal.setAttribute('aria-hidden','true');
      }

      infoBtn?.addEventListener('click', openInfo);
      closeInfo?.addEventListener('click', closeInfoModal);
      infoBackdrop?.addEventListener('click', closeInfoModal);
      window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeInfoModal(); });
    })();
    </script>
  </main>

  <!-- Pie -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-logo">
        <img src="{{ url_for('static', filename='images/Arecibo.png') }}" alt="">
      </div>
      <div class="footer-info">
        <a href="https://upra.edu/contactenos/"><p id="location-link"><i class="fa-solid fa-location-dot icon"></i> Carr. 653 Km. 0.8 Sector Las Dunas, Arecibo</p></a>
        <p><i class="fa-solid fa-phone icon"></i> 787-815-0000 / Fax 787-880-4972</p>
      </div>
    </div>
  </footer>

</body>
</html>
